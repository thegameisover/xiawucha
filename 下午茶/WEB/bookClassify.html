<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="bookClassify.css">
    <link rel="stylesheet" href="index.css">
</head>

<body>
    <div id="bookClassify">
        <el-container>
            <el-header>
                <el-button type="primary" round @click="all">全部</el-button>
                <el-button type="primary" round @click="wenxue">文学</el-button>
                <el-button type="primary" round @click="lishi">历史</el-button>
                <el-button type="primary" round @click="kehuan">科幻</el-button>
                <el-button type="primary" round @click="xuanhuan">玄幻</el-button>
                <el-button type="primary" round @click="tonghua">童话故事</el-button>
                <el-button type="primary" round @click="manhua">漫画</el-button>
                <el-button type="primary" round @click="nuobeier">诺贝尔文学奖</el-button>
            </el-header>
            <el-main>
                <template>
                    <div id="BookShow">
                  <ul class="infinite-list" v-infinite-scroll="load" style="overflow:hidden" >
                    <li v-for="p in book" class="infinite-list-item" @click="ReadBook(p.id)">
                            <div>
                            <img :src= "p.picture"  height="150px" width="100%">
                            </div>
                            <div>
                            {{p.name}}
                            </div>
                    </li>
                  </ul>
                  </div>
                </template>
            </el-main>
        </el-container>
    </div>
</body>
<script src="vue.js"></script>
<script src="elements.js"></script>
<script type="text/javascript">
    new Vue({
        el: '#bookClassify',
        data: {
            book: [],
            type: '',
            page: 0,
            n: 0,
            name: '',
        },
        methods: {
            load() {

                if (this.$data.n == 0) {
                    this.$data.page += this.$data.page + 14;
                    var _this = this;
                    var xhr = new XMLHttpRequest();
                    xhr.open("get", "http://127.0.0.1:8080/AllBook?num=" + this.$data.page);
                    xhr.setRequestHeader("Content-Type", "application/json");
                    xhr.withCredentials = true;
                    xhr.send();
                    xhr.onreadystatechange = function() {
                        if (xhr.readyState === 4) {
                            if (xhr.responseText == "null") {
                                _this.$data.n = 1;
                            } else if (xhr.responseText == "false") {
                                alert("系统错误");
                            } else {
                                var json = JSON.parse(xhr.responseText);

                                for (var i in json) {
                                    _this.$data.book.push({
                                        id: json[i][2],
                                        picture: json[i][1],
                                        name: json[i][0]
                                    });
                                };
                            }
                        }
                    };
                }
            },
            wenxue() {
                var _this = this;
                this.$data.type = '文学';
                this.$data.book = [];
                var xhr = new XMLHttpRequest();
                xhr.open("get", "http://127.0.0.1:8080/classificationBook?id=0&type=" + this.$data.type);
                xhr.setRequestHeader("Content-Type", "application/json");
                xhr.withCredentials = true;
                xhr.send();
                xhr.onreadystatechange = function() {
                    if (xhr.readyState === 4) {
                        if (xhr.responseText == "null") {
                            _this.$data.n = 1;
                        } else if (xhr.responseText == "false") {
                            alert("系统错误");
                        } else {
                            var json = JSON.parse(xhr.responseText);
                            for (var i in json) {
                                _this.$data.book.push({
                                    id: json[i][1],
                                    picture: json[i][2],
                                    name: json[i][0]
                                });
                            };
                        }
                    }
                };

            },
            lishi() {
                this.$data.type = '历史';
                var _this = this;
                this.$data.book = [];
                var xhr = new XMLHttpRequest();
                xhr.open("get", "http://127.0.0.1:8080/classificationBook?id=0&type=" + this.$data.type);
                xhr.setRequestHeader("Content-Type", "application/json");
                xhr.withCredentials = true;
                xhr.send();
                xhr.onreadystatechange = function() {
                    if (xhr.readyState === 4) {
                        if (xhr.responseText == "null") {
                            _this.$data.n = 1;
                        } else if (xhr.responseText == "false") {
                            alert("系统错误");
                        } else {
                            var json = JSON.parse(xhr.responseText);
                            for (var i in json) {
                                _this.$data.book.push({
                                    id: json[i][1],
                                    picture: json[i][2],
                                    name: json[i][0]
                                });
                            };
                        }
                    }
                };
            },
            kehuan() {
                this.$data.type = '科幻';
                var _this = this;
                this.$data.book = [];
                var xhr = new XMLHttpRequest();
                xhr.open("get", "http://127.0.0.1:8080/classificationBook?id=0&type=" + this.$data.type);
                xhr.setRequestHeader("Content-Type", "application/json");
                xhr.withCredentials = true;
                xhr.send();
                xhr.onreadystatechange = function() {
                    if (xhr.readyState === 4) {
                        if (xhr.responseText == "null") {
                            _this.$data.n = 1;
                        } else if (xhr.responseText == "false") {
                            alert("系统错误");
                        } else {
                            var json = JSON.parse(xhr.responseText);
                            for (var i in json) {
                                _this.$data.book.push({
                                    id: json[i][1],
                                    picture: json[i][2],
                                    name: json[i][0]
                                });
                            };
                        }
                    }
                };
            },
            xuanhuan() {
                this.$data.type = '玄幻';
                var _this = this;
                this.$data.book = [];
                var xhr = new XMLHttpRequest();
                xhr.open("get", "http://127.0.0.1:8080/classificationBook?id=0&type=" + this.$data.type);
                xhr.setRequestHeader("Content-Type", "application/json");
                xhr.withCredentials = true;
                xhr.send();
                xhr.onreadystatechange = function() {
                    if (xhr.readyState === 4) {
                        if (xhr.responseText == "null") {
                            _this.$data.n = 1;
                        } else if (xhr.responseText == "false") {
                            alert("系统错误");
                        } else {
                            var json = JSON.parse(xhr.responseText);
                            for (var i in json) {
                                _this.$data.book.push({
                                    id: json[i][1],
                                    picture: json[i][2],
                                    name: json[i][0]
                                });
                            };
                        }
                    }
                };
            },
            tonghua() {
                this.$data.type = '童话';
                var _this = this;
                this.$data.book = [];
                var xhr = new XMLHttpRequest();
                xhr.open("get", "http://127.0.0.1:8080/classificationBook?id=0&type=" + this.$data.type);
                xhr.setRequestHeader("Content-Type", "application/json");
                xhr.withCredentials = true;
                xhr.send();
                xhr.onreadystatechange = function() {
                    if (xhr.readyState === 4) {
                        if (xhr.responseText == "null") {
                            _this.$data.n = 1;
                        } else if (xhr.responseText == "false") {
                            alert("系统错误");
                        } else {
                            var json = JSON.parse(xhr.responseText);
                            for (var i in json) {
                                _this.$data.book.push({
                                    id: json[i][1],
                                    picture: json[i][2],
                                    name: json[i][0]
                                });
                            };
                        }
                    }
                };
            },
            manhua() {
                this.$data.type = '漫画';
                var _this = this;
                this.$data.book = [];
                var xhr = new XMLHttpRequest();
                xhr.open("get", "http://127.0.0.1:8080/classificationBook?id=0&type=" + this.$data.type);
                xhr.setRequestHeader("Content-Type", "application/json");
                xhr.withCredentials = true;
                xhr.send();
                xhr.onreadystatechange = function() {
                    if (xhr.readyState === 4) {
                        if (xhr.responseText == "null") {
                            _this.$data.n = 1;
                        } else if (xhr.responseText == "false") {
                            alert("系统错误");
                        } else {
                            var json = JSON.parse(xhr.responseText);
                            for (var i in json) {
                                _this.$data.book.push({
                                    id: json[i][1],
                                    picture: json[i][2],
                                    name: json[i][0]
                                });
                            };
                        }
                    }
                };
            },
            nuobeier() {
                this.$data.type = '诺贝尔';
                var _this = this;
                this.$data.book = [];
                var xhr = new XMLHttpRequest();
                xhr.open("get", "http://127.0.0.1:8080/classificationBook?id=0&type=" + this.$data.type);
                xhr.setRequestHeader("Content-Type", "application/json");
                xhr.withCredentials = true;
                xhr.send();
                xhr.onreadystatechange = function() {
                    if (xhr.readyState === 4) {
                        if (xhr.responseText == "null") {
                            _this.$data.n = 1;
                        } else if (xhr.responseText == "false") {
                            alert("系统错误");
                        } else {
                            var json = JSON.parse(xhr.responseText);
                            for (var i in json) {
                                _this.$data.book.push({
                                    id: json[i][1],
                                    picture: json[i][2],
                                    name: json[i][0]
                                });
                            };
                        }
                    }
                };
            },
            all() {
                this.$data.page = 0;
                this.$data.n = 0;
                this.$data.type = 'all';
                var _this = this;
                this.$data.book = [];
                var xhr = new XMLHttpRequest();
                xhr.open("get", "http://127.0.0.1:8080/AllBook?num=0");
                xhr.setRequestHeader("Content-Type", "application/json");
                xhr.withCredentials = true;
                xhr.send();
                xhr.onreadystatechange = function() {
                    if (xhr.readyState === 4) {
                        if (xhr.responseText != "false") {
                            var json = JSON.parse(xhr.responseText);
                            for (var i in json) {
                                _this.$data.book.push({
                                    id: json[i][2],
                                    picture: json[i][1],
                                    name: json[i][0]
                                });
                            };
                        }
                    }
                };
            },
            ReadBook(id) {
                window.open("readBook.html?" + id);
            }
        },
        mounted() {
            var p = location.search;
            p = p.slice(p.indexOf('?') + 1);
            this.$data.name = p;
            var _this = this;
            var xhr = new XMLHttpRequest();
            xhr.open("get", "http://127.0.0.1:8080/AllBook?num=" + this.$data.page);
            xhr.setRequestHeader("Content-Type", "application/json");
            xhr.withCredentials = true;
            xhr.send();
            xhr.onreadystatechange = function() {
                if (xhr.readyState === 4) {
                    if (xhr.responseText != "false") {
                        var json = JSON.parse(xhr.responseText);
                        for (var i in json) {
                            _this.$data.book.push({
                                id: json[i][2],
                                picture: json[i][1],
                                name: json[i][0]
                            });
                        };
                    }
                }
            };
        },
    })
</script>

</html>